using System;
using System.IO;
using System.IO.Pipes;
using System.Text;
using System.Threading;
using System.Diagnostics;
using System.Collections.Generic;

class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("Agent A started...");
        Process.GetCurrentProcess().ProcessorAffinity = (IntPtr)1; // Core 0

        string folderPath = args.Length > 0 ? args[0] : ".";
        var output = new StringBuilder();

        foreach (var file in Directory.GetFiles(folderPath, "*.txt"))
        {
            var wordCounts = new Dictionary<string, int>();
            foreach (var line in File.ReadAllLines(file))
            {
                foreach (var word in line.Split(' ', StringSplitOptions.RemoveEmptyEntries))
                {
                    var w = word.ToLower();
                    if (!wordCounts.ContainsKey(w)) wordCounts[w] = 0;
                    wordCounts[w]++;
                }
            }

            foreach (var pair in wordCounts)
                output.AppendLine($"{Path.GetFileName(file)}:{pair.Key}:{pair.Value}");
        }

        using var pipe = new NamedPipeClientStream(".", "agent1", PipeDirection.Out);
        pipe.Connect();
        using var writer = new StreamWriter(pipe) { AutoFlush = true };
        writer.Write(output.ToString());

        Console.WriteLine("Agent A done.");
    }
}
